version: 2

models:
  - name: base__hubspot__contact_form_submission
    description: Each record represents a contact form is submitted
    columns:
      - name: id
        description: The ID of the event.
        tests: 
          - unique
          - not_null
      - name: contact_id
        description: Contact ID
        tests:
          - dbt_utils.cardinality_equality: # many-to-one
              field: contact_id
              to: ref('base__hubspot__contact')
              config:
                severity: warn

  - name: base__hubspot__contact_list_member
    description: Each record represents a combination of a contact and the list they belong to
    columns:
      - name: id
        description: The ID of the event.
        tests: 
          - unique
          - not_null
      - name: contact_id
        description: Contact ID
        tests:
          - dbt_utils.cardinality_equality: # many-to-one
              field: contact_id
              to: ref('base__hubspot__contact')
              config:
                severity: warn
      - name: contact_list_id
        description: Contact List ID
        tests:
          - dbt_utils.cardinality_equality: # many-to-one
              field: contact_list_id
              to: ref('base__hubspot__contact_list')
              config:
                severity: warn

  - name: base__hubspot__contact_list
    description: Each record represents a contact list, used to map contact & contact_list_member
    columns:
      - name: contact_list_id
        description: Contact List ID
        tests: 
          - unique
          - not_null

  - name: base__hubspot__contact
    description: Each record represents a contact and its attributes
    columns:
      - name: contact_id
        description: Contact ID - PK of the table
        tests: 
          - unique
          - not_null
      - name: contact_email
        description: Contact email
        tests: 
          - unique
          - not_null

  - name: base__hubspot__email_campaign
    description: Each record represents an email campaign and its atributes
    columns:
      - name: email_campaign_id
        description: The ID of the email campaign.
        tests: 
          - unique
          - not_null

  - name: base__hubspot__email_event
    description: Each record represents an email event (send, open, click,...)
    columns:
      - name: email_event_id
        description: The ID of the event.
        tests: 
          - unique
          - not_null
      - name: email_campaign_id
        description: Email campaign ID
        tests:
          - dbt_utils.cardinality_equality: # many-to-one
              field: email_campaign_id
              to: ref('base__hubspot__email_campaign')
              config:
                severity: warn
      - name: recipient
        description: email of campaign recipient
        tests:
          - dbt_utils.cardinality_equality: # many-to-one
              field: contact_email
              to: ref('base__hubspot__contact')
              config:
                severity: warn

  - name: base__hubspot__email_subscription_change
    description: Each record represents subscription event (subribe, unsubcribe,..)
    columns:
      - name: id
        description: The ID of the event.
        tests: 
          - unique
          - not_null
      - name: caused_by_event_id
        description: Event ID that caused the subscription event
        tests:
          - dbt_utils.cardinality_equality: # many-to-one
              field: email_event_id
              to: ref('base__hubspot__email_event')
              config:
                severity: warn
      - name: email_subscription_id
        description: ID of an email subscription
        tests:
          - dbt_utils.cardinality_equality: # many-to-one
              field: email_subscription_id
              to: ref('base__hubspot__email_subscription')
              config:
                severity: warn

  - name: base__hubspot__email_subscription
    description: Each record represents a subscription
    columns:
      - name: email_subscription_id
        description: The ID of the email subscription.
        tests: 
          - unique
          - not_null

  - name: base__hubspot__engagement
    description: Each record represents an engagement in Hubspot
    columns:
      - name: engagement_id
        description: The ID of the engagement
        tests: 
          - unique
          - not_null

  - name: base__hubspot__engagement_contact
    description: Each record represents a 'link' between a contact and an engagement.
    columns:
      - name: engagement_contact_id
        description: The ID of each contact in an engagement.
        tests: 
          - unique
          - not_null

  - name: base__hubspot__engagement_deal
    description: Each record represents a 'link' between a deal and an engagement.
    columns:
      - name: engagement_deal_id
        description: The ID of each deal in an engagement.
        tests: 
          - unique
          - not_null

  - name: base__hubspot__engagement_company
    description: Each record represents a 'link' between a company and an engagement.
    columns:
      - name: engagement_company_id
        description: The ID of each company in an engagement.
        tests: 
          - unique
          - not_null
          
  - name: base__hubspot__deal
    description: Each record represents a deal in Hubspot.
    columns:
      - name: deal_id
        description: The ID of the deal
        tests:
          - not_null
          - unique

      - name: portal_id
        description: '{{ doc("hubspot_portal_id") }}'

      - name: deal_pipeline_id
        description: The ID of the deal's pipeline.
        tests:
          - dbt_utils.cardinality_equality: 
              field: deal_pipeline_id
              to: ref('base__hubspot__deal_pipeline')
              config:
                severity: warn

      - name: deal_pipeline_stage_id
        description: The ID of the deal's pipeline stage.
        tests:
          - dbt_utils.cardinality_equality: 
              field: deal_pipeline_stage_id
              to: ref('base__hubspot__deal_pipeline_stage')
              config:
                severity: warn

      - name: owner_id
        description: The ID of the deal's owner. 
        tests:
          - dbt_utils.cardinality_equality: 
              field: owner_id
              to: ref('base__hubspot__owner')
              config:
                severity: warn

      - name: deal_name
        description: The name you have given this deal.

      - name: description
        description: A brief description of the deal.

      - name: amount
        description: The total value of the deal in the deal's currency.

      - name: closed_at
        description: The day the deal is expected to close, or was closed.

      - name: created_at
        description: The date the deal was created. This property is set automatically by HubSpot.

  - name: base__hubspot__deal_pipeline
    description: Each record represents a pipeline in Hubspot.
    columns:
      - name: deal_pipeline_id
        description: The ID of the pipeline.
        tests:
          - unique
          - not_null

      - name: display_order
        description: Used to determine the order in which the pipelines appear when viewed in HubSpot

      - name: is_active
        description: Whether the stage is currently in use.

      - name: pipeline_label
        description: The human-readable label for the pipeline. The label is used when showing the pipeline in HubSpot.

  - name: base__hubspot__deal_pipeline_stage
    description: Each record represents a deal stage.
    columns:
      - name: deal_pipeline_stage_id
        description: Deal stage id 
        tests:
          - unique
          - not_null
      - name: _fivetran_active
        description: '{{ doc("_fivetran_active") }}'
      - name: _fivetran_end
        description: '{{ doc("_fivetran_end") }}'
      - name: _fivetran_start
        description: '{{ doc("_fivetran_start") }}'
      - name: _fivetran_synced
        description: '{{ doc("_fivetran_synced") }}'
      - name: date_entered
        description: The timestamp the deal stage was entered.
      - name: deal_id
        description: Reference to the deal.
      - name: source
        description: The relevant source of the deal stage.
      - name: source_id
        description: Reference to the source.
      - name: deal_stage_name
        description: The value of the deal stage. Typically the name of the stage.
   
  - name: base__hubspot__owner
    description: Each record represents an owner/user in Hubspot.
    columns:
      - name: owner_id
        description: The ID of the owner.
        tests:
          - unique
          - not_null

      - name: created_at
        description: A timestamp for when the owner was created.

      - name: email_address
        description: The email address of the owner.

      - name: first_name
        description: The first name of the owner.

      - name: full_name
        description: Full name of the owner.

      - name: last_name
        description: The last name of the owner.

      - name: portal_id
        description: '{{ doc("hubspot_portal_id") }}'

      - name: owner_type
        description: The type of owner.

      - name: updated_at
        description: A timestamp for when the owner was last updated.
  
  - name: base__hubspot__deal_stage
    description: Each record represents a deal stage.
    columns:
      - name: deal_id
        description: Reference to the deal.
        tests:
          - unique
          - not_null
      - name: _fivetran_active
        description: '{{ doc("_fivetran_active") }}'
      - name: _fivetran_end
        description: '{{ doc("_fivetran_end") }}'
      - name: _fivetran_start
        description: '{{ doc("_fivetran_start") }}'
      - name: _fivetran_synced
        description: '{{ doc("_fivetran_synced") }}'
      - name: date_entered
        description: The timestamp the deal stage was entered.
      - name: source
        description: The relevant source of the deal stage.
      - name: source_id
        description: Reference to the source.
      - name: deal_stage_name
        description: The value of the deal stage. Typically the name of the stage.

  - name: base__hubspot__company
    description: Each record represents a company and it's attribution in Hubspot.
    columns:
      - name: company_id
        description: The ID of each company.
        tests: 
          - unique
          - not_null
