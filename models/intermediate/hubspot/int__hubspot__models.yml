version: 2

models:
  - name: int__hubspot__email_subscriptions_aggregates
    description: "Total subscribe/unsubscribe events aggregated by the event_id which leads to that subscribe/unsubscribe events"
    columns:
      - name: caused_by_event_id
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
          - dbt_utils.cardinality_equality: # one-to-one # need to recheck
              field: email_event_id
              to: ref('base__hubspot__email_event')
              config:
                severity: warn

      - name: recipient
        tests:
          - dbt_utils.cardinality_equality: # many-to-many
              field: contact_email
              to: ref('int__hubspot__contacts_joins')
              config:
                severity: warn

  # - name: int__hubspot__email_events_aggregates
  #   description: "Each record represents a send event and its metrics (clicks, opens,...)"
  #   columns:
  #     - name: email_send_id
  #       tests:
  #         - unique
  #         - not_null
  #         - dbt_utils.at_least_one
  #     - name: email_campaign_id
  #       description:
  #       tests:
  #         - dbt_utils.cardinality_equality: # many-to-one
  #           field: email_campaign_id
  #           to: ref('base__hubspot__email_campaign')
  #     - name: recipient
  #       description:
  #       tests:
  #         - dbt_utils.cardinality_equality: # many-to-many
  #           field: contact_email
  #           to: ref('int__hubspot__contacts_joins')

  - name: int__hubspot__email_conversions_aggregates
    description: "Each record represents a contact and the times they submitted a contact form (conversion event)"
    columns:
      - name: contact_id
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
          - dbt_utils.cardinality_equality: # one-to-many
              field: contact_id
              to: ref('int__hubspot__contacts_joins')
              config:
                severity: warn

  - name: int__hubspot__contacts_joins
    description: "Each record represents a combination of a contact and the member list that they belong to"
    columns:
      - name: id
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one

  - name: int__hubspot__engagements
    description: Each record represents an engagement 
    columns:
      - name: engagement_id
        description: The ID of the engagement.
        tests:
          - not_null
          - unique
          - dbt_utils.at_least_one

      - name: _fivetran_synced
        description: '{{ doc("_fivetran_synced") }}'

      - name: activity_type
        description: The engagement's activity type.

      - name: created_timestamp
        description: A timestamp representing when the engagement was created.

      - name: engagement_type
        description: One of NOTE, EMAIL, TASK, MEETING, or CALL, the type of the engagement.

      - name: is_active
        description: Whether the engagement is currently being shown in the UI.

      - name: last_updated_timestamp
        description: A timestamp in representing when the engagement was last updated.

      - name: occurred_timestamp
        description: A timestamp in representing the time that the engagement should appear in the timeline.

      - name: owner_id
        description: The ID of the engagement's owner.

      - name: portal_id
        description: '{{ doc("hubspot_portal_id") }}'

      - name: contact_ids
        description: List of contacts related to the engagement.

      - name: deal_ids
        description: List of deals related to the engagement.

      - name: company_ids
        description: List of companies related to the engagement.
