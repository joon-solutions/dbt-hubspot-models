version: 2
models:
  - name: fct__outreach_sf__sequence
    description: >-
      This table provides information on how well an Outreach sequence is
      performing. Sequences' metrics not just include the interactions with a
      sequence but also the number of opportunities (from both Outreach &
      Salesforce datasource) associated with a certain sequence
    columns:
      - name: id
        description: unique ID, which is the combination of sequence_id & account_id
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
        meta:
          dimension:
            type: string
      - name: account_id
        description: "{{ doc(\"outreach_sf_account_id\") }}"
        meta:
          dimension:
            type: string
          metrics:
            total_accounts:
              type: count
            total_accounts_delivered:
              type: count
              filters:
                - has_delivered: true
            total_accounts_opened:
              type: count
              filters:
                - has_opened: true
            total_accounts_clicked:
              type: count
              filters:
                - has_clicked: true
            total_accounts_scheduled:
              type: count
              filters:
                - has_scheduled: true
            total_accounts_opened_deals:
              type: count
              filters:
                - has_opened_deals: true
            total_accounts_won_deals:
              type: count
              filters:
                - has_won_deals: true
      - name: sequence_id
        description: "{{ doc(\"outreach_sf_sequence_id\") }}"
        meta:
          dimension:
            type: number
      - name: sequence_name
        description: "{{ doc(\"outreach_sf_sequence_name\") }}"
        meta:
          dimension:
            type: string
      - name: created_at
        description: "{{doc('created_at')}}"
        meta:
          dimension:
            type: timestamp
      - name: updated_at
        description: >-
          The date and time the sequence state for a specific account was last
          updated.
        meta:
          dimension:
            type: timestamp
      - name: total_deliver
        description: The total count of delivered mailings from this sequence.
        meta:
          metrics:
            total_deliver_agg:
              type: sum
      - name: total_failure
        description: The total count of failed mailings from this sequence.
        meta:
          metrics:
            total_failure_agg:
              type: sum
      - name: total_bounce
        description: The total count of bounced mailings during this sequence.
        meta:
          metrics:
            total_bounce_agg:
              type: sum
      - name: total_click
        description: The total count of clicked mailings from this sequence.
        meta:
          metrics:
            total_click_agg:
              type: sum
      - name: total_open
        description: The total count of opened mailings from this sequence.
        meta:
          metrics:
            total_open_agg:
              type: sum
      - name: total_negative_reply
        description: The total count of negative reply mailings from this sequence.
        meta:
          metrics:
            total_negative_reply_agg:
              type: number
      - name: total_neutral_reply
        description: The total count of neutral reply mailings from this sequence.
        meta:
          metrics:
            total_neutral_reply_agg:
              type: sum
      - name: total_opt_out
        description: The total count of opted out mailings from this sequence.
        meta:
          metrics:
            total_opt_out_agg:
              type: sum
      - name: total_positive_reply
        description: The total count of positive reply mailings from this sequence.
        meta:
          metrics:
            total_positive_reply_agg:
              type: sum
      - name: total_reply
        description: The total count of replied mailings from this sequence.
        meta:
          metrics:
            total_reply_agg:
              type: sum
      - name: total_schedule
        description: The total count of scheduled mailings from this sequence.
        meta:
          metrics:
            total_schedule_agg:
              type: sum
      - name: total_deals
        description: >-
          Total opportunities recorded in both SF & Outreach and associated with
          a sequenced account
        meta:
          metrics:
            total_deals_agg:
              type: sum
      - name: total_won_deals
        description: >-
          Total won opportunities recorded in both SF & Outreach and associated
          with a sequenced account
        meta:
          metrics:
            total_won_deals_agg:
              type: sum
      - name: total_lost_deals
        description: >-
          Total lost opportunities recorded in both SF & Outreach and associated
          with a sequenced account
        meta:
          metrics:
            total_lost_deals_agg:
              type: sum
      - name: total_opportunity_amount
        description: >-
          Total opportunities amount recorded in both SF & Outreach and
          associated with a sequenced account
        meta:
          metrics:
            total_opportunity_amount_agg:
              type: sum
      - name: total_won_deals_amount
        description: >-
          Total won opportunities amount recorded in both SF & Outreach and
          associated with a sequenced account
        meta:
          metrics:
            total_won_deals_amount_agg:
              type: sum
      - name: total_lost_deals_amount
        description: >-
          Total lost opportunities amount recorded in both SF & Outreach and
          associated with a sequenced account
        meta:
          metrics:
            total_lost_deals_amount_agg:
              type: sum
      - name: has_delivered
        description: >-
          booleans type, a true value indicates that an account was successfully
          delivered the email in the sequence
        meta:
          dimension:
            type: boolean
      - name: has_opened
        description: >-
          booleans type, a true value indicates that an account opened the email
          in the sequence
        meta:
          dimension:
            type: boolean
      - name: has_clicked
        description: >-
          booleans type, a true value indicates that an account clicked the
          email in the sequence
        meta:
          dimension:
            type: boolean
      - name: has_scheduled
        description: >-
          booleans type, a true value indicates that an account scheduled after
          receiving emails in the sequence
        meta:
          dimension:
            type: boolean
      - name: has_opened_deals
        description: >-
          booleans type, a true value indicates that an account opened at least
          one deal after receiving emails in the sequence
        meta:
          dimension:
            type: boolean
      - name: has_won_deals
        description: >-
          booleans type, a true value indicates that an account signed at least
          one deal after receiving emails in the sequence
        meta:
          dimension:
            type: boolean
  - name: fct__outreach_sf__account
    description: The combination of Outreach & Salesforce Account joined with Opportunity
    columns:
      - name: account_id
        description: "{{ doc('outreach_sf_account_id') }}"
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
        meta:
          dimension:
            type: string
          metrics:
            number_of_account:
              type: count
      - name: sf_account_id
        description: account_id from salesforce
        meta:
          dimension:
            type: string
          metrics:
            number_of_sf_account:
              type: count
      - name: outreach_account_id
        description: account_id from outreach
        meta:
          dimension:
            type: string
          metrics:
            number_of_outreach_account:
              type: count
      - name: account_status
        description: >-
          The customer status defined by the number of won and lost cases.
          (lost_customer, customer, prospective, lead)
        meta:
          dimension:
            type: string
      - name: amount_won
        description: total amount won for the account
        meta:
          dimension:
            type: number
          metrics:
            total_amount_won:
              type: sum
      - name: amount_lost
        description: total amount lost for the account
        meta:
          dimension:
            type: number
          metrics:
            total_amount_lost:
              type: sum
      - name: count_won
        description: total number of won cases for the account
        meta:
          dimension:
            type: number
      - name: count_lost
        description: total number of lost cases for the account
        meta:
          dimension:
            type: number
      - name: count_closed
        description: total number of closed cases for the account
        meta:
          dimension:
            type: number
      - name: count_open
        description: total number of open cases for the account
        meta:
          dimension:
            type: number
      - name: account_host
        description: ""
        meta:
          dimension:
            type: string
      - name: account_name
        description: ""
        meta:
          dimension:
            type: string
      - name: number_of_employees
        description: ""
        meta:
          dimension:
            type: number
          metrics:
            avg_no_of_employee:
              type: average
      - name: source
        description: ""
        meta:
          dimension:
            type: string
      - name: industry
        description: ""
        meta:
          dimension:
            type: string
      - name: buyer_intent_score
        description: ""
        meta:
          dimension:
            type: number
          metrics:
            avg_buyer_intent_score:
              type: average
      - name: account_created_at
        description: ""
        meta:
          dimension:
            type: timestamp
      - name: domain
        description: ""
        meta:
          dimension:
            type: string
      - name: billing_country
        description: ""
        meta:
          dimension:
            type: string
      - name: billing_postal_code
        description: ""
        meta:
          dimension:
            type: string
      - name: number_of_opportunity
        description: ""
        meta:
          dimension:
            type: number
      - name: opportunity_probability
        description: ""
        meta:
          dimension:
            type: number
          metrics:
            avg_probability:
              type: average
  - name: fct__outreach_sf__task
    description: >-
      Each record represent a task filed in either Outreach or Salesforce app.
      The table contains tasks' attributes, as well as its allocated points
      calculated by its evaluated importance on converting a customer (an
      account)
    columns:
      - name: task_id
        description: "{{ doc(\"outreach_sf_task_id\") }}"
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
        meta:
          dimension:
            type: string
          metrics:
            total_tasks:
              type: count
      - name: account_id
        description: "{{ doc(\"outreach_sf_account_id\") }}"
      - name: completed_at
        description: The time when a task was completed
      - name: task_action_type
        description: >-
          The action type of the task, for example 'action_item', 'call',
          'email', or 'in_person'
        meta:
          dimension:
            type: string
      - name: first_opportunity_open_at
        description: The time when first oppotunity associated with the account was opened
      - name: first_opportunity_closed_at
        description: The time when first oppotunity associated with the account was opened
      - name: total_touches
        description: Total tasks (Sales activity) were put upon the account
        meta:
          metrics:
            avg_total_touches_per_account:
              type: average
      - name: task_day_intervals
        description: Time difference in days between the task & next task completion time
        meta:
          metrics:
            avg_task_day_intervals:
              type: average
      - name: touch_number
        description: The order of a task in a series of tasks of each account
      - name: timeframe
        description: >
          There are two timeframe: 'from open to close won opportunity' -
          evaluate Sales attempts during the timespan between first deal opened
          and first deal closed won." 'before open opportunity' - evaluate Sales
          attempts during the timespan between first contact and first deal
          opened.
      - name: forty_twenty_forty_points
        description: >-
          Allocated point for given task based on twenty-forty rule, details
          https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_forty_twenty_forty_points:
              type: sum
      - name: first_touch_points
        description: >-
          Allocated point for given task based on first-touch rule, details
          https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_first_touch_points:
              type: sum
      - name: last_touch_points
        description: >-
          Allocated point for given task based on last-touch rule, details
          https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_last_touch_points:
              type: sum
      - name: linear_points
        description: >-
          Allocated point for given task based on linear rule, details
          https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_linear_points:
              type: sum

  - name: fct__outreach_sf__opportunity_by_account
    description: The combination of Outreach & Salesforce Opportunity joined with Account information, pivot.
    columns:
      - name: opportunity_account_scd_id
        description: ''
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
      - name: forty_twenty_forty_amounts
        description: >-
          Allocated opportunity amount for given task based on twenty-forty
          rule, details
          https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_forty_twenty_forty_amounts:
              type: sum
      - name: first_touch_amounts
        description: >-
          Allocated opportunity amount for given task based on first-touch rule,
          details https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_first_touch_amounts:
              type: sum
      - name: last_touch_amounts
        description: >-
          Allocated opportunity amount for given task based on last-touch rule,
          details https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_last_touch_amounts:
              type: sum
      - name: linear_amounts
        description: >-
          Allocated opportunity amount for given task based on linear rule,
          details https://agencyanalytics.com/blog/marketing-attribution-models
        meta:
          metrics:
            total_linear_amounts:
              type: sum
  - name: fct__outreach_sf__opportunity
    description: >-
      The combination of Outreach & Salesforce Opportunity enriched with
      information about the sales rep in charge of the deal
    columns:
      - name: opportunity_id
        description: "{{ doc('outreach_sf_opportunity_id') }}"
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
        meta:
          dimension:
            type: string
          metrics:
            number_of_account:
              type: count

  - name: rpt__outreach_sf__account_scd
    description: The combination of Outreach & Salesforce Opportunity joined with Account information
    columns:
      - name: id
        description: ''
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
        meta:
          dimension:
            type: string
          metrics:
            number_of_account:
              type: count

      - name: outreach_opportunity_id
        description: Id of the opportunity in Outreach database
        meta:
          dimension:
            type: string
      - name: outreach_account_id
        description: Id of the account in Outreach database
        meta:
          dimension:
            type: string
      - name: outreach_owner_id
        description: Id of the opportunity's sales rep in Outreach database
        meta:
          dimension:
            type: string
      - name: sf_opportunity_id
        description: Id of the opportunity in Salesforce database
        meta:
          dimension:
            type: number
      - name: sf_account_id
        description: Id of the account in Salesforce database
        meta:
          dimension:
            type: number
      - name: sf_owner_id
        description: Id of opportunity's sales rep in Salesforce database
        meta:
          dimension:
            type: number
      - name: opportunity_name
        description: Opportunity name
        meta:
          dimension:
            type: string
      - name: amount
        description: Opportunity amount
        meta:
          dimension:
            type: number
          metrics:
            total_amount:
              type: sum
      - name: close_date
        description: Day when opportunity is closed
        meta:
          dimension:
            type: timestamp
      - name: opportunity_status
        description: Status of th opportunity
        meta:
          dimension:
            type: string
      - name: opportunity_probability
        description: the field that quantifies the likelihood of winning an opportunity
        meta:
          dimension:
            type: number
      - name: is_closed
        description: Boolean field indicating whether an opportunity is closed
        meta:
          dimension:
            type: boolean
      - name: created_at
        description: Date when opportunity is created
        meta:
          dimension:
            type: timestamp
      - name: source
        description: "Data source: either salesforce or outreach"
        meta:
          dimension:
            type: string
      - name: count_won
        description: total number of won cases for the account
        meta:
          dimension:
            type: number
          metrics:
            total_won_opportunity:
              type: sum
      - name: count_lost
        description: total number of lost cases for the account
        meta:
          dimension:
            type: number
          metrics:
            total_lost_opportunity:
              type: sum
      - name: count_closed
        description: total number of closed cases for the account
        meta:
          dimension:
            type: number
          metrics:
            total_closed_opportunity:
              type: sum
      - name: count_open
        description: total number of open cases for the account
        meta:
          dimension:
            type: number
          metrics:
            total_open_opportunity:
              type: sum
      - name: amount_won
        description: total amount won for the account
        meta:
          dimension:
            type: number
          metrics:
            total_amount_won:
              type: sum
      - name: amount_lost
        description: total amount lost for the account
        meta:
          dimension:
            type: number
          metrics:
            total_amount_lost:
              type: sum
      - name: sales_rep_email
        description: Email of the sales rep of the opportunity
        meta:
          dimension:
            type: string
      - name: sales_rep_name
        description: Name of the sales rep of the opportunity
        meta:
          dimension:
            type: string
      - name: sales_rep_title
        description: Job title of the sales rep of the opportunity
        meta:
          dimension:
            type: string
      - name: sales_rep_phone_number
        description: Phone number of the sales rep of the opportunity
        meta:
          dimension:
            type: string
