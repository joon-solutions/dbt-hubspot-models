version: 2

models:

  - name: fct__salesforce__combined
    description: This snapshot provides monthly and quarterly metrics that help you understand how your opportunities are performing. Metrics around bookings, the current pipeline and loses are included.
    columns:
      - name: opportunity_id
        description: unique ID of the table
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
        meta:
          dimension:
            type: string

      - name: number_of_employees
        description: Number of employees.
        meta:
          dimension:
            type: number

      - name: opportunity_status
        description: Status (Won, Lost, or Pipeline).
        meta:
          dimension:
            type: string

      - name: opportunity_name
        description: Opportunity Name.
        meta:
          dimension:
            type: string

      - name: account_name
        description: Account Name.
        meta:
          dimension:
            type: string

      - name: forecast_category
        description: Forecast Category.
        meta:
          dimension:
            type: string

      - name: stage_name
        description: Stage Name.
        meta:
          dimension:
            type: string

      - name: created_amount_this_month
        description: The created amount this month.
        meta:
          metrics:
            total_amount_this_month:
              type: sum
      
      - name: created_amount_this_quarter
        description: The created amount this quarter.
        meta:
          metrics:
            total_amount_this_quarter:
              type: sum

      - name: closed_amount_this_month
        description: The closed amount this month.
        meta:
          metrics:
            total_closed_this_quarter:
              type: sum
      
      - name: closed_amount_this_quarter
        description: The closed amount this quarter.
        meta:
          metrics:
            total_closed_this_quarter:
              type: sum
      
      - name: account_type
        description: The account type.
        meta:
          dimension:
            type: string

      - name: created_date
        description: Created date.
        meta:
          dimension:
            type: date
      
      - name: close_date
        description: Closed date.
        meta:
          dimension:
            type: date

      - name: is_won
        description: Is won flag.
        meta:
          metrics:
            total_won:
              type: count
      
      - name: is_closed
        description: Is closed flag. True when the stage name is closed.
        meta:
          metrics:
            total_closed:
              type: count

      - name: opportunity_owner_name
        description: Opportunity Owner name.
        meta:
          dimension:
            type: string
      
      - name: opportunity_manager_name
        description: Opportunity Manager name.
        meta:
          dimension:
            type: string
      
      - name: amount
        description: Amount.
        meta:
          dimension:
            type: number

      - name: days_since_created
        description: Days since created
        meta:
          dimension:
            type: number

      - name: days_to_close
        description: Days to close
        meta:
          dimension:
            type: number


  - name: fct__salesforce__source
    description: This table provides information around a MKT source, how many leads, customers, opportunities,etc that came from a certain source
    columns:
      - name: id
        description: PK of the table, which is the combination of lead_source & utm flag
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
      - name: lead_source
        description: The leadâ€™s source.
      - name: utm_medium
        description: The UTM medium
      - name: utm_source 
        description: The UTM source
      - name: utm_campaign
        description: The UTM campaign
      - name: total_opportunities
        description: Total number of opportunities associated with a specified source
      - name: total_won_opportunities
        description:  Total number of won opportunities associated with a specified source
      - name: total_lost_opportunities
        description: Total number of lost opportunities associated with a specified source
      - name: total_open_opportunities
        description: Total number of open opportunities associated with a specified source
      - name: total_won_amount
        description: Total amount of won opportunities associated with a specified source
      - name: total_lost_amount
        description: Total amount of lost opportunities associated with a specified source
      - name: total_open_amount
        description: Total amount of open opportunities associated with a specified source
      - name: unique_leads_count
        description: Total leads associated with a specified source
      - name: unique_prospective_count
        description: Total prospects (accounts havent had any closed deals yet, only open deals) associated with a specified source
      - name: unique_lost_customers_count
        description: Total lost customers (accounts havent had any won deals yet, only lost deals) associated with a specified source
      - name: unique_customers_count
        description: Total customers (accounts have had at least one deal) associated with a specified source

