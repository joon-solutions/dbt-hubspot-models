version: 2

models:

  - name: fct__salesforce__combined
    description: This snapshot provides monthly and quarterly metrics that help you understand how your opportunities are performing. Metrics around bookings, the current pipeline and loses are included.
    columns:
      - name: opportunity_id
        description: unique ID of the table
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
        meta:
          dimension:
            type: string

      - name: number_of_employees
        description: Number of employees.
        meta:
          dimension:
            type: number

      - name: opportunity_status
        description: Status (Won, Lost, or Pipeline).
        meta:
          dimension:
            type: string

      - name: opportunity_name
        description: Opportunity Name.
        meta:
          dimension:
            type: string

      - name: account_name
        description: Account Name.
        meta:
          dimension:
            type: string

      - name: forecast_category
        description: Forecast Category.
        meta:
          dimension:
            type: string

      - name: stage_name
        description: Stage Name.
        meta:
          dimension:
            type: string

      - name: created_amount_this_month
        description: The created amount this month.
        meta:
          metrics:
            total_amount_this_month:
              type: sum
      
      - name: created_amount_this_quarter
        description: The created amount this quarter.
        meta:
          metrics:
            total_amount_this_quarter:
              type: sum

      - name: closed_amount_this_month
        description: The closed amount this month.
        meta:
          metrics:
            total_closed_this_quarter:
              type: sum
      
      - name: closed_amount_this_quarter
        description: The closed amount this quarter.
        meta:
          metrics:
            total_closed_this_quarter:
              type: sum
      
      - name: account_type
        description: The account type.
        meta:
          dimension:
            type: string

      - name: created_date
        description: Created date.
        meta:
          dimension:
            type: date
      
      - name: close_date
        description: Closed date.
        meta:
          dimension:
            type: date

      - name: is_won
        description: Is won flag.
        meta:
          metrics:
            total_won:
              type: count
      
      - name: is_closed
        description: Is closed flag. True when the stage name is closed.
        meta:
          metrics:
            total_closed:
              type: count

      - name: opportunity_owner_name
        description: Opportunity Owner name.
        meta:
          dimension:
            type: string
      
      - name: opportunity_manager_name
        description: Opportunity Manager name.
        meta:
          dimension:
            type: string
      
      - name: amount
        description: Amount.
        meta:
          dimension:
            type: number

      - name: days_since_created
        description: Days since created
        meta:
          dimension:
            type: number

      - name: days_to_close
        description: Days to close
        meta:
          dimension:
            type: number

  - name: fct__salesforce__owner_performance
    description: Each record represents an individual member of the sales team, enriched with data about their pipeline, bookings, loses, and win percentages.
    columns:
      - name: owner_id
        description: '{{ doc("sf_owner_id") }}'
        tests:
          - unique
          - not_null
          - dbt_utils.at_least_one
      - name: sf_avg_bookings_amount
        description: '{{ doc("sf_avg_bookings_amount") }}'
      - name: avg_days_open
        description: '{{ doc("sf_avg_days_open") }}'
      - name: avg_days_to_close
        description: '{{ doc("sf_avg_days_to_close") }}'
      - name: avg_pipeline_opp_amount
        description: '{{ doc("sf_avg_pipeline_opp_amount") }}'
      - name: b_manager_id
        description: Manager ID of the booking_by_owner CTE.  Helper field.
      - name: b_owner_id
        description: Owner ID of the booking_by_owner CTE.  Helper field.
      - name: bookings_amount_closed_this_month
        description: '{{ doc("sf_bookings_amount_closed_this_month") }}'
      - name: bookings_amount_closed_this_quarter
        description: '{{ doc("sf_bookings_amount_closed_this_quarter") }}'
      - name: bookings_count_closed_this_month
        description: '{{ doc("sf_bookings_count_closed_this_month") }}'
      - name: bookings_count_closed_this_quarter
        description: '{{ doc("sf_bookings_count_closed_this_quarter") }}'
      - name: l_manager_id
        description: Manager ID of the lost_by_owner CTE.  Helper field.
      - name: l_owner_id
        description: Owner ID of the lost_by_owner CTE.  Helper field.
      - name: largest_booking
        description: '{{ doc("sf_largest_booking") }}'
      - name: largest_deal_in_pipeline
        description: '{{ doc("sf_largest_deal_in_pipeline") }}'
      - name: lost_amount_this_month
        description: '{{ doc("sf_lost_amount_this_month") }}'
      - name: lost_amount_this_quarter
        description: '{{ doc("sf_lost_amount_this_quarter") }}'
      - name: lost_count_this_month
        description: '{{ doc("sf_lost_count_this_month") }}'
      - name: lost_count_this_quarter
        description: '{{ doc("sf_lost_count_this_quarter") }}'
      - name: manager_id
        description: Manager ID associated with opportunities.
      - name: owner_city
        description: The city associated with the owner.
      - name: owner_name
        description: The first and last name of the owner.
      - name: owner_state
        description: The state associated with the owner.
      - name: p_manager_id
        description: Manager ID of the pipeline_by_owner CTE.  Helper field.
      - name: p_owner_id
        description: Owner ID of the pipeline_by_owner CTE.  Helper field.
      - name: pipeline_count_created_this_month
        description: '{{ doc("sf_pipeline_count_created_this_month") }}'
      - name: pipeline_count_created_this_quarter
        description: '{{ doc("sf_pipeline_count_created_this_quarter") }}'
      - name: pipeline_created_amount_this_month
        description: '{{ doc("sf_pipeline_created_amount_this_month") }}'
      - name: pipeline_created_amount_this_quarter
        description: '{{ doc("sf_pipeline_created_amount_this_quarter") }}'
      - name: pipeline_created_forecast_amount_this_month
        description: '{{ doc("sf_pipeline_created_forecast_amount_this_month") }}'
      - name: pipeline_created_forecast_amount_this_quarter
        description: '{{ doc("sf_pipeline_created_forecast_amount_this_quarter") }}'
      - name: total_bookings_amount
        description: '{{ doc("sf_total_bookings_amount") }}'
      - name: total_lost_amount
        description: '{{ doc("sf_total_lost_amount") }}'
      - name: total_number_bookings
        description: '{{ doc("sf_total_number_bookings") }}'
      - name: total_number_lost
        description: '{{ doc("sf_total_number_lost") }}'
      - name: total_number_pipeline
        description: '{{ doc("sf_total_number_pipeline") }}'
      - name: total_pipeline_amount
        description: '{{ doc("sf_total_pipeline_amount") }}'
      - name: total_pipeline_forecast_amount
        description: '{{ doc("sf_total_pipeline_forecast_amount") }}'
      - name: total_win_percent
        description: '{{ doc("sf_total_win_percent") }}'
      - name: win_percent_this_month
        description: '{{ doc("sf_win_percent_this_month") }}'
      - name: win_percent_this_quarter
        description: '{{ doc("sf_win_percent_this_quarter") }}'
    